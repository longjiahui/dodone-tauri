//! `SeaORM` Entity, @generated by sea-orm-codegen 2.0.0-rc.17

use sea_orm::entity::prelude::*;
use serde::{Deserialize, Serialize};

use crate::{
    entities::{task, NumberType},
    utils::option3::{de_option3, Option3},
};

#[derive(DeriveActiveEnum, EnumIter, Clone, Debug, PartialEq, Eq, Hash, Serialize, Deserialize)]
#[sea_orm(rs_type = "String", db_type = "String(StringLen::None)")]
pub enum TaskState {
    #[sea_orm(string_value = "DONE")]
    DONE,
    #[sea_orm(string_value = "UNDONE")]
    UNDONE,
}

#[sea_orm::model]
#[derive(Clone, Debug, PartialEq, DeriveEntityModel, Eq, Serialize, Deserialize)]
#[sea_orm(table_name = "Task")]
pub struct Model {
    #[sea_orm(column_name = "sortOrder", default_value = 0, indexed)]
    pub sort_order: i32,
    #[sea_orm(primary_key, auto_increment = false, column_type = "Text")]
    pub id: String,
    #[sea_orm(column_type = "Text")]
    pub content: String,
    #[sea_orm(column_type = "Text", nullable)]
    pub description: Option<String>,
    #[sea_orm(column_name = "groupId", column_type = "Text", indexed)]
    pub group_id: String,
    #[sea_orm(column_name = "createdAt")]
    pub created_at: DateTimeUtc,
    #[sea_orm(column_name = "updatedAt")]
    pub updated_at: DateTimeUtc,
    #[sea_orm(column_name = "doneAt", indexed)]
    pub done_at: Option<DateTimeUtc>,
    #[sea_orm(column_name = "startAt", indexed)]
    pub start_at: Option<DateTimeUtc>,
    #[sea_orm(column_name = "endAt", indexed)]
    pub end_at: Option<DateTimeUtc>,
    #[sea_orm(column_type = "Text", indexed)]
    pub state: TaskState,
    #[sea_orm(default_value = 25, indexed)]
    pub priority: i32,
    #[sea_orm(default_value = 1)]
    pub factor: i32,
    #[sea_orm(column_name = "parentId", column_type = "Text", nullable, indexed)]
    pub parent_id: Option<String>,
    #[sea_orm(column_name = "createIndex", default_value = 0)]
    pub create_index: i32,
    #[sea_orm(
        column_name = "createdByTaskId",
        column_type = "Text",
        nullable,
        indexed
    )]
    pub created_by_task_id: Option<String>,
    pub target: Option<NumberType>,
    #[sea_orm(column_name = "targetType", column_type = "Text", nullable)]
    pub target_type: Option<String>,
    #[sea_orm(has_one)]
    pub next_task: HasOne<super::next_task::Entity>,
    #[sea_orm(
        self_ref,
        relation_enum = "SelfRef2",
        from = "created_by_task_id",
        to = "id",
        on_update = "Cascade",
        on_delete = "SetNull"
    )]
    pub created_by_task: HasOne<Entity>,
    #[sea_orm(
        self_ref,
        relation_enum = "SelfRef1",
        from = "parent_id",
        to = "id",
        on_update = "Cascade",
        on_delete = "Cascade"
    )]
    pub parent: HasOne<Entity>,
    #[sea_orm(has_one)]
    pub task_anchor: HasOne<super::task_anchor::Entity>,
    #[sea_orm(
        belongs_to,
        from = "group_id",
        to = "id",
        on_update = "Cascade",
        on_delete = "Cascade"
    )]
    pub task_group: HasOne<super::task_group::Entity>,
    #[sea_orm(has_many)]
    pub task_in_days: HasMany<super::task_in_day::Entity>,
    #[sea_orm(has_many)]
    pub task_target_records: HasMany<super::task_target_record::Entity>,
    #[sea_orm(has_many)]
    pub task_view_tasks: HasMany<super::task_view_task::Entity>,
}

impl ActiveModelBehavior for ActiveModel {}

#[derive(Debug, Deserialize, Serialize)]
pub struct CreateModel {
    pub content: String,
    pub group_id: String,
    pub create_index: Option<i32>,
    pub priority: Option<i32>,
    pub factor: Option<i32>,
    pub description: Option<String>,
    pub parent_id: Option<String>,
    pub state: Option<TaskState>,
    pub target: Option<NumberType>,
    pub target_type: Option<String>,
    pub start_at: Option<String>,
    pub end_at: Option<String>,
    pub done_at: Option<String>,
    pub created_by_task_id: Option<String>,
}

// export type BatchCreateTask = {
//   task: Partial<
//     Omit<
//       Task,
//       | "state"
//       | "id"
//       | "children"
//       | "nextTask"
//       | "createdAt"
//       | "updatedAt"
//       | "taskViewTasks"
//     >
//   > &
//     Required<Pick<Task, TaskRequiredKeys>>
//   nextTask?: Omit<NextTask, "taskId" | "id" | "createdAt" | "updatedAt">
//   children?: BatchCreateTask[]
// }

#[derive(Debug, Deserialize, Serialize)]
pub struct BatchCreateTaskModel {
    pub task: CreateModel,
    pub next_task: Option<super::next_task::CreateModelForBatchCreateTask>,
    pub children: Option<Vec<BatchCreateTaskModel>>,
}

#[derive(Debug, Deserialize, Serialize, Clone)]
pub struct UpdateModel {
    pub id: Option<String>,
    pub sort_order: Option<i32>,
    pub content: Option<String>,
    pub group_id: Option<String>,
    pub create_index: Option<i32>,
    pub priority: Option<i32>,
    pub factor: Option<i32>,
    pub state: Option<TaskState>,
    #[serde(default, deserialize_with = "de_option3")]
    pub description: Option3<String>,
    #[serde(default, deserialize_with = "de_option3")]
    pub parent_id: Option3<String>,
    #[serde(default, deserialize_with = "de_option3")]
    pub target: Option3<NumberType>,
    #[serde(default, deserialize_with = "de_option3")]
    pub target_type: Option3<String>,
    #[serde(default, deserialize_with = "de_option3")]
    pub start_at: Option3<String>,
    #[serde(default, deserialize_with = "de_option3")]
    pub end_at: Option3<String>,
    #[serde(default, deserialize_with = "de_option3")]
    pub done_at: Option3<String>,
    #[serde(default, deserialize_with = "de_option3")]
    pub created_by_task_id: Option3<String>,
}

#[derive(Deserialize, Serialize, Debug, Clone)]
pub struct BatchEditTasksResult {
    pub created: Vec<task::Model>,
    pub updated: Vec<task::Model>,
}
